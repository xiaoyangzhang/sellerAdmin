<link href="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.css" rel="stylesheet">
<script src="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.js" type="text/javascript"></script>

<div >
	<form class="form-signin" id="itemListForm" action="$!utilWebconfig.getActionDefaultFontPath()/item/list" method="GET" role="form">
        <div class="inputGroup whole">
            <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">商品名称：</button>
                </span>
                <input type="text"  class="form-control" name="name" value="$!query.name"/>
            </div>
			<div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">商品编号：</button>
                </span>
                <input type="text"  class="form-control" name="itemId" value="$!query.itemId"/>
            </div>
			<div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">商品类型：</button>
                </span>
                <select class="form-control" name="itemType">
					<option value="" #if(!$query.itemType) selected #end>全部</option>
					#foreach($itemType in $itemTypeList)
					<option value="$!{itemType.value}" #if($query.itemType == $itemType.value) selected #end >$!{itemType.text}</option>
					#end
                </select>
            </div>
            <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">状态：</button>
                </span>
                <select class="form-control" name="status">
					<option value="" #if(!$query.status) selected #end>全部</option>
					#foreach($itemStatus in $itemStatusList)
                    <option value="$!{itemStatus.value}" #if($query.status == $itemStatus.value) selected #end >$!{itemStatus.text}</option>
					#end
                </select>
            </div>
			<div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">发布时间</button>
                </span>
                <input type="text" class='form-control form-date dateInp' placeholder='' readonly name="beginDate" value="$!commodityListQuery.beginDate">
                <span class="input-group-addon fix-border fix-padding dateInpCenter">至</span>
                <input type="text" class='form-control form-date dateInp' placeholder='' readonly name="endDate" value="$!commodityListQuery.endDate">
            </div>
			<div class="btn-group">
                <button type="submit" class="btn btn-primary form-submit">查询</button>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary form-clear">重置</button>
            </div>
        </div>
        <div class="inputGroup whole">
			 <div class="btn-group">
               <button type="button" class="btn btn-primary batch-shelve">批量上架</button>
             </div>
			 <div class="btn-group">
               <button type="button" class="btn btn-primary batch-unshelve">批量下架</button>
             </div>
			 <div class="btn-group">
               <button type="button" class="btn btn-primary batch-deleate">批量删除</button>
             </div>
		 </div>
		 <div class="tableGroup whole">
             <table class="table datatable">
				<thead>
                    <tr>
                        <th>编号</th>
                        <th>商品信息</th>
						<th>目的地</th>
                        <th>类型</th>
                        <th>单价</th>
						<th>状态</th>
						<th>发布时间</th>
						<th>操作</th>
                    </tr>
                </thead>
				<tbody >
                    #foreach($item in $pageVo.resultList)
                    <tr id="item_$!{item.id}" item-id="$!item.id">
                        <td>$!item.id</td>
                        <td>$!item.name</td>
						<td>$!item.destString</td>
						<td>$!{utilItem.getItemTypeName($item.type)}</td>
						<td>￥$!{utilMoney.centToYuanMoneyFormat($item.price)}</td>
                        <td>$!{utilItem.getItemStatusName($item.status)}</td>
						<td>$!{utilDate.date2String($item.publishDate)}</td>
                        <td>
							#if($item.containsOperate('VIEW'))
							<a class="btn btn-primary" href="$!utilWebconfig.getActionDefaultFontPath()/line/detail/$!item.id/" target="_blank">查看</a>
							#end
							#if($item.containsOperate('EDIT'))
							<a class="btn btn-primary" href="$!utilWebconfig.getActionDefaultFontPath()/line/detail/$!item.id/" target="_blank">编辑</a>
							#end
							#if($item.containsOperate('SHELVE'))
							<button type="button" class="btn btn-primary item-shelve" item-id="$!item.id">上架</button>
							#end
							#if($item.containsOperate('UNSHELVE'))
							<button type="button" class="btn btn-primary item-unshelve" item-id="$!item.id">下架</button>
							#end
						</td>
                    </tr>
					#end
                </tbody>
            </table>
        </div>
    #*分页*#
    #parse("/page.vm")
    #pageStyle("itemListForm")
    </form>
</div>
<script>
	$(".form-clear").click(function() {
		$(".form-data").clear();
	});
	$(".form-date").datetimepicker({
        language:  "zh-CN",
        weekStart: 1,
        todayBtn:  1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0,
        format: "yyyy-mm-dd"
    });
	var checkedIdList=[];
	$('table.datatable').datatable({
		checkable: true,
		checksChanged: function(event) {
			var temp = [];
			$(event.checks.checks).each(function() {
				var item_id = $("#" + this).attr("item-id");
				temp.push(item_id);
			});
			checkedIdList = temp;
        }
	});
	//批量上架
    $('.batch-shelve').click(function(){
		if(checkedIdList.length > 0) {
    		var param = {itemIds:checkedIdList};
    		$.post("$!{utilWebconfig.getActionDefaultFontPath()}/item/batchShelve",param,function(result) {
    			if(result.success) {
    				window.location.reload();
    			} else {
    				layer.alert('批量上架失败', {
    					icon : 2
    				});
    			}
    		},"json");
		} else {
			layer.msg('请选择标签', {
				icon : 2,
				time : 1000
			});
		}
    });
	//批量下架
    $('.batch-unshelve').click(function(){
		if(checkedIdList.length > 0) {
    		var param = {itemIds:checkedIdList};
    		$.post("$!{utilWebconfig.getActionDefaultFontPath()}/item/batchUnshelve",param,function(result) {
    			if(result.success) {
    				window.location.reload();
    			} else {
    				layer.alert('批量下架失败', {
    					icon : 2
    				});
    			}
    		},"json");
		}  else {
			layer.msg('请选择标签', {
				icon : 2,
				time : 1000
			});
		}
    });
	// 上架
	$('.item-shelve').click(function(){
		var id = $(this).attr("item-id");
		$.post("$!{utilWebconfig.getActionDefaultFontPath()}/item/"+id+"/shelve",{},function(result) {
			if(result.success) {
				window.location.reload();
			} else {
				layer.msg('上架失败', {
    				icon : 2,
    				time : 1000
    			});
			}
		},"json");
    });
	// 下架
	$('.item-unshelve').click(function(){
		var id = $(this).attr("item-id");
		$.post("$!{utilWebconfig.getActionDefaultFontPath()}/item/"+id+"/unshelve",{},function(result) {
			if(result.success) {
				window.location.reload();
			} else {
				layer.msg('下架失败', {
    				icon : 2,
    				time : 1000
    			});
			}
		},"json");
    });
</script>